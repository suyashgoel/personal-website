generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model Entry {
  id           Int                    @id @default(autoincrement())
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  title        String
  slug         String                 @unique
  type         EntryType
  embedding Unsupported("vector(3072)")?
  body         String
  imageContent ImageContent?
  linkContent  LinkContent?

  @@map("entries")
}

model ImageContent {
  id      Int    @id @default(autoincrement())
  url     String
  width   Int
  height  Int
  entryId Int    @unique
  entry   Entry  @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@map("entry_images")
}

model LinkContent {
  id            Int     @id @default(autoincrement())
  url           String
  resolvedTitle String?
  resolvedDesc  String?
  resolvedImage String?
  subtype       String?
  entryId       Int     @unique
  entry         Entry   @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@map("entry_links")
}

model User {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  hashedPassword String
  createdAt      DateTime @default(now())
  name           String
  role           RoleType @default(user)

  @@map("users")
}

model About {
  id             Int      @id @default(autoincrement())
  content        Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("about_content")
}

enum EntryType {
  text
  image
  link
}

enum RoleType {
  admin
  user
}
